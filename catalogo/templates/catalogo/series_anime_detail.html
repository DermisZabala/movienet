{% extends "catalogo/base.html" %}
{% load static %}

{% block title %}{{ item.title }}{% endblock %} {# Assuming item.titulo becomes item.title #}

{% block content %}
<div class="container detail-page series-anime-detail-page">
    <article class="content-detail">
        <header class="content-detail__header">
            <img src="{{ item.poster }}" alt="{{ item.title }} Poster" class="content-detail__poster" loading="lazy"> {# Assuming item.titulo becomes item.title #}
            <div class="content-detail__info">
                <h1>{{ item.title }} ({{ item.year }})</h1> {# Assuming item.titulo, item.anio become item.title, item.year #}
                <p><strong>Genre:</strong> {{ item.genre|join:", " }}</p> {# Assuming item.genero becomes item.genre #}
                <p><strong>Rating:</strong> {{ item.rating }}/10</p> {# Assuming item.calificacion becomes item.rating #}
                {% if item.cast %} {# Assuming item.elenco becomes item.cast #}
                <p><strong>Cast:</strong> {{ item.cast|join:", " }}</p>
                {% endif %}
                <h3>General Synopsis</h3>
                <p class="content-detail__synopsis">{{ item.synopsis }}</p> {# Assuming item.sinopsis becomes item.synopsis #}
            </div>
        </header>

        <section class="content-detail__player-section" id="dynamic-player-section" style="display:none;">
            <h2 id="current-episode-title-player"></h2>
            <div class="video-player-wrapper">
                <div class="video-player-container">
                    <iframe
                        id="series-anime-main-iframe-player" {# New ID for the iframe #}
                        frameborder="0"
                        allowfullscreen
                        scrolling="no"
                        allow="autoplay; encrypted-media"
                        src="" {# Will be loaded dynamically by JS #}
                        ></iframe>
                </div>
            </div>
            <div id="current-episode-controls" class="player-options-controls episode-controls">
                <h4>Available Servers (Episode):</h4>
                <div class="server-selection-controls" id="episode-server-buttons">
                    {# "Server N" buttons for the episode will be inserted here by JS #}
                </div>
                <div class="report-controls" id="episode-report-button-container">
                    {# The "Report Video" button for the episode will be inserted here by JS #}
                </div>
            </div>
        </section>

        <section class="seasons-episodes-section">
            <h2>Seasons and Episodes</h2>
            {% if item.seasons %} {# Assuming item.temporadas becomes item.seasons #}
                {% for season in item.seasons %} {# Assuming temporada becomes season #}
                <div class="season-block">
                    <h3 class="season-title">
                        Season {{ season.number }} {# Assuming temporada.numero becomes season.number #}
                        <span class="season-toggle-icon">â–¼</span>
                    </h3>
                    <div class="season-episodes-content">
                        <ul class="episode-list">
                            {% for episode in season.episodes %} {# Assuming episodio becomes episode #}
                            <li class="episode-item"
                                data-episode-title="{{ episode.title }}" {# Assuming episodio.titulo becomes episode.title #}
                                data-episode-iframes="{{ episode.iframes|join:'|||' }}"
                                data-content-id="{{ item.id }}"
                                data-content-title="{{ item.title }}" {# General series/anime title, assuming item.titulo becomes item.title #}
                                data-item-type="{{ content_type }}"> {# Assuming tipo_contenido becomes content_type, passed as 'series' or 'anime' #}
                                <div class="episode-item__info">
                                    <span class="episode-item__title">{{ episode.title }}</span> {# Assuming episodio.titulo becomes episode.title #}
                                    {% if episode.synopsis %} {# Assuming episodio.sinopsis becomes episode.synopsis #}
                                        <p class="episode-item__synopsis">{{ episode.synopsis }}</p>
                                    {% endif %}
                                </div>
                                <button class="button button--primary play-episode-master-btn">
                                    Watch Episode
                                </button>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="message message--info">No season or episode information available for {{ item.title }}.</p> {# Assuming item.titulo becomes item.title #}
            {% endif %}
        </section>
    </article>

    <div class="ad-space ad-detail-page">
        <span>Advertisement on Detail Page</span>
    </div>
</div>
{% endblock %}