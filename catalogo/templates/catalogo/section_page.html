{% extends "catalogo/base.html" %}
{% load static %}

{% block title %}{{ section_title }}{% endblock %} {# Assuming titulo_seccion becomes section_title passed in English #}

{% block content %}
<div class="container section-page-container">
    <h1 class="section-title">{{ section_title }}</h1> {# Assuming titulo_seccion becomes section_title #}

    {% if error_carga %} {# Assuming error_carga becomes error_loading or similar in view context #}
        <p class="message message--error">There was a problem loading the content. Please try again later or contact the administrator.</p>
    {% elif items or resultados %} {# Assuming resultados becomes results #}
        <div class="card-grid" id="content-grid">
            {% with items_to_display=items|default:resultados %} {# Assuming resultados becomes results #}
                {% for item in items_to_display %}
                    {% comment %} Determine the correct detail URL {% endcomment %}
                    {% if item.type == 'movie' or not item.type and content_type == 'movies' %} {# Assuming item.tipo -> item.type and tipo_contenido -> content_type #}
                        {% url 'catalogo:movie_detail' item_id=item.id as final_detail_url %}
                        {% include "./partials/card.html" with item=item detail_url=final_detail_url %}
                    {% elif item.type == 'series' or not item.type and content_type == 'series' %} {# Assuming item.tipo -> item.type and tipo_contenido -> content_type #}
                        {% url 'catalogo:serie_detail' item_id=item.id as final_detail_url %}
                        {% include "./partials/card.html" with item=item detail_url=final_detail_url %}
                    {% elif item.type == 'anime' or not item.type and content_type == 'anime' %} {# Assuming item.tipo -> item.type and tipo_contenido -> content_type #}
                        {% url 'catalogo:anime_detail' item_id=item.id as final_detail_url %}
                        {% include "./partials/card.html" with item=item detail_url=final_detail_url %}
                    {% else %}
                         {# This else would be reached if item.type is not movie/series/anime AND
                            content_type is also not movies/series/anime (or item.type exists and is none of them).
                            This would indicate a problem with the data or view logic.
                            As a safe fallback, an anchor link is used.
                         #}
                         {% include "./partials/card.html" with item=item detail_url="#" %}
                    {% endif %}
                {% endfor %}
            {% endwith %}
        </div>
        {# "Show more" button only for section views, not for search results #}
        {% if content_type != 'search' and items and items|length > 0 %} {# Assuming tipo_contenido -> content_type #}
        <button id="show-more-btn" class="button button--primary button--load-more">Show more</button>
        {% endif %}
    {% else %}
        <p class="message">
            {% if query %}
                No results found for "{{ query }}". Try other terms.
            {% else %}
                No content available in this section at the moment.
            {% endif %}
        </p>
    {% endif %}

    <aside class="ad-space ad-sidebar">
        <span>Sidebar Advertisement</span>
    </aside>
</div>
{% endblock %}